<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::title}, ~{::section})}">
<head>
    <title>Página Instruções</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<section class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Instruções do Viveiro</h2>
        <button class="btn btn-success"
                th:attr="data-url=@{/fazendas/{id}/viveiros/{idViveiro}/instrucoes/nova(id=${idFazenda}, idViveiro=${idViveiro})}"
                onclick="abrirModal(this)">
            + Nova Instrução
        </button>
    </div>

    <table class="table table-hover align-middle">
        <thead>
        <tr>
            <th>Título</th>
            <th>Status</th>
            <th>Autor</th>
            <th>Data</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="instrucao : ${instrucoes}">
            <td th:text="${instrucao.titulo}">---</td>
            <td th:text="${instrucao.status}">---</td>
            <td th:text="${instrucao.autor}">---</td>
            <td th:text="${#temporals.format(instrucao.dataCriacao, 'dd/MM/yyyy')}">---</td>
            <td class="text-center">
                <div class="d-flex justify-content-center gap-2">
                    <button class="btn btn-sm btn-info" title="Visualizar detalhes"
                            th:attr="data-url=@{/fazendas/{id}/viveiros/{idViveiro}/instrucoes/{idInstrucao}(id=${idFazenda},idViveiro=${idViveiro},idInstrucao=${instrucao.id})}"
                            onclick="abrirModal(this)">
                        👁️
                    </button>

                    <button class="btn btn-sm btn-warning" title="Editar instrução"
                            th:attr="data-url=@{/fazendas/{id}/viveiros/{idViveiro}/instrucoes/{idInstrucao}/editar(id=${idFazenda},idViveiro=${idViveiro},idInstrucao=${instrucao.id})}"
                            onclick="abrirModal(this)">
                        ✏️
                    </button>

                    <form th:action="@{/fazendas/{id}/viveiros/{idViveiro}/instrucoes/{idInstrucao}/remover(id=${idFazenda},idViveiro=${idViveiro},idInstrucao=${instrucao.id})}"
                          method="post" style="display:inline;">
                        <button class="btn btn-sm btn-danger" title="Excluir instrução" type="submit">
                            🗑️
                        </button>
                    </form>
                </div>
                <small class="text-muted d-block mt-1">👁️ Ver &nbsp;&nbsp; ✏️ Editar &nbsp;&nbsp; 🗑️ Excluir</small>
            </td>

        </tr>
        </tbody>
    </table>

    <!-- container de modal -->
    <div id="modal-container" class="modal fade" tabindex="-1"></div>

    <script>
        function abrirModal(btn) {
            const url = btn.getAttribute('data-url');
            fetch(url)
                .then(res => res.text())
                .then(html => {
                    document.getElementById('modal-container').innerHTML = html;
                    const modal = new bootstrap.Modal(document.getElementById('modal-container'));
                    modal.show();

                    // recarrega após fechamento
                    document.getElementById('modal-container')
                        .addEventListener('hidden.bs.modal', () => window.location.reload());
                });
        }
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</section>
</body>
</html>
